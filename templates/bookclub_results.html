<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ì¡° í¸ì„± ê²°ê³¼</title>
  <style>
    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ì€ ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤ */
    :root { --primary: #4a90e2; --card: #fff; --bg: #f7f9fc; --text: #333; --border: #ddd; }
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family: sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; display: flex; flex-direction: column; }
    header { background: var(--primary); color: #fff; padding: 1rem; text-align: center; font-size: 1.2rem; }
    .container { flex: 1; padding: 1rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; display: flex; flex-direction: column; }
    .card h2 { margin-bottom: 0.5rem; font-size: 1.1rem; color: var(--primary); }
    .card ul { list-style: none; margin-bottom: 1rem; flex: 1; }
    .card li { padding: 0.3rem 0; border-bottom: 1px solid var(--border); font-size: 0.95rem; }
    .card button { background: var(--primary); color: #fff; border: none; padding: 0.6rem; border-radius: 4px; cursor: pointer; font-size: 0.95rem; }
    .screenshot-view { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:#fff; overflow:auto; padding:2rem; box-sizing:border-box; z-index:100; }
    .screenshot-view.active { display:block; }
    .screenshot-view .group-block { background: var(--card); border:1px solid var(--border); border-radius:6px; padding:1rem; margin-bottom:1rem; font-size:1.3rem; text-align:center; }
    .actions { position: fixed; bottom:1rem; left:50%; transform:translateX(-50%); display:flex; gap:1rem; }
    .actions button { padding:0.6rem 1.2rem; border:none; border-radius:4px; cursor:pointer; font-size:1rem; }
    .actions .confirm { background: #28a745; color:#fff; }
    .actions .cancel  { background: #6c757d; color:#fff; }
    .screen-mode .container, .screen-mode header { display: none; }
  </style>
</head>
<body>

  <header>ğŸ§  ì¡° í¸ì„± ì¶”ì²œì•ˆ</header>

  <div class="container">
    {% for suggestion in suggestions %}
      <div class="card">
        <h2>ì¶”ì²œì•ˆ {{ loop.index }}</h2>
        <ul>
          {% for group in suggestion %}
            <li>
              <strong>
                {% if group_names and group_names[loop.index0] %}
                  {{ group_names[loop.index0] }}
                {% else %}
                  ê·¸ë£¹ {{ loop.index }}
                {% endif %}:
              </strong>
              {{ group|join(', ') }}
            </li>
          {% endfor %}
        </ul>
        <button onclick='previewSuggestion({{ suggestion|tojson }})'>
          ìŠ¤í¬ë¦°ìƒ·ìš© ë¯¸ë¦¬ë³´ê¸°
        </button>
      </div>
    {% endfor %}
  </div>

  <div id="screenshot" class="screenshot-view">
    <div id="screenshot-groups"></div>
    <div class="actions">
      <button class="confirm" onclick="saveAndExit()">ì €ì¥ í›„ ì¢…ë£Œ</button>
      <button class="cancel"  onclick="cancelPreview()">ë‹¤ì‹œ ì„ íƒ</button>
    </div>
  </div>

  <script>
    const present      = {{ present|tojson }};
    const facilitators = {{ facilitators|tojson }};
    const groupNames   = {{ group_names|tojson }};
    let selectedGroupsForSave = null;

    function previewSuggestion(groups) {
      selectedGroupsForSave = groups; // ì €ì¥í•  ê·¸ë£¹ ì •ë³´ ì„ì‹œ ì €ì¥
      document.body.classList.add('screen-mode');
      const cont = document.getElementById('screenshot-groups');
      cont.innerHTML = '';
      groups.forEach((grp, i) => {
        const d = document.createElement('div');
        d.className = 'group-block';
        d.textContent = (groupNames[i]||`ê·¸ë£¹ ${i+1}`) + ': ' + grp.join(', ');
        cont.appendChild(d);
      });
      document.getElementById('screenshot').classList.add('active');
    }

    function saveAndExit() {
      if (!selectedGroupsForSave) {
          alert('ì €ì¥í•  ê·¸ë£¹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
          return;
      }

      fetch('/api/bookclub/save',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          date: new Date().toISOString().split('T')[0],
          groups: selectedGroupsForSave,
          present,
          facilitators
        })
      }).then(r=>{
        if(r.ok) {
            alert('ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            // [ìˆ˜ì •] ì €ì¥ í›„ ì¡° í¸ì„± í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ê²½ë¡œ ë³€ê²½
            window.location='/making_team'
        }
        else {
            alert('ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.')
        }
      });
    }

    function cancelPreview() {
      selectedGroupsForSave = null; // ì„ì‹œ ì €ì¥ ì •ë³´ ì´ˆê¸°í™”
      document.body.classList.remove('screen-mode');
      document.getElementById('screenshot').classList.remove('active');
    }
  </script>

</body>
</html>
